name: Quran Website CI/CD

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  validate:
    name: Validate Website
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ› Checkout code
      uses: actions/checkout@v3
      
    - name: ğŸ˜ Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: mbstring, xml, json
        coverage: none
        
    - name: ğŸ“¦ Install PHPUnit
      run: composer require --dev phpunit/phpunit ^9.0 --no-progress
        
    - name: ğŸ§ª Run Validation Tests
      run: composer test-ci -- --verbose
      
    - name: ğŸ” Syntax Check
      run: |
        echo "Checking PHP syntax..."
        for file in *.php; do
          if [ -f "$file" ]; then
            php -l "$file" || exit 1
          fi
        done
        echo "âœ… All PHP files syntax OK"
        
    - name: ğŸ“ File Existence Check
      run: |
        echo "Checking required files..."
        required_files=("index.php" "gallery.php" "about.php" "kontak.php" "panduan.php")
        missing_files=0
        
        for file in "${required_files[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file exists"
          else
            echo "âŒ $file is missing"
            missing_files=$((missing_files + 1))
          fi
        done
        
        if [ $missing_files -gt 0 ]; then
          echo "âš ï¸  Missing $missing_files required file(s)"
          exit 1
        fi
        
    - name: ğŸ“Š Generate Summary
      if: always()
      run: |
        echo "ğŸ“Š CI/CD Validation Summary"
        echo "=========================="
        echo "ğŸ“… Run: $(date)"
        echo "ğŸŒ¿ Branch: ${{ github.ref }}"
        echo "ğŸ”— Commit: ${{ github.sha }}"
        echo "=========================="